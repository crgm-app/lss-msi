<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heartbeat Clock</title>
    <style>
        /* --- Configuraci√≥n General --- */
        :root {
            --bg-color: #080808;
            --color-borde: #222;
            
            /* Paleta de Colores */
            --neon-blue: #00f3ff;
            --neon-red: #ff0055;
            --text-dim: #444;
            --text-light: #aaa;
            
            --manecilla-dia: #00f3ff;
            --manecilla-seg: #ff0055;
            --manecilla-min: rgba(255, 255, 255, 0.15); /* Fantasma */
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column; /* Para acomodar el t√≠tulo arriba */
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            user-select: none;
        }

        /* --- T√≠tulo --- */
        .titulo-principal {
            position: absolute;
            top: 15vh;
            font-family: 'Courier New', monospace;
            font-size: 3vmin;
            letter-spacing: 1vmin;
            color: var(--text-light);
            text-transform: uppercase;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            z-index: 50;
            opacity: 0.8;
        }

        /* --- Botonera --- */
        .controles {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #888;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            font-family: sans-serif;
            outline: none;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .btn.activo {
            background: rgba(0, 243, 255, 0.2);
            color: var(--neon-blue);
            border-color: var(--neon-blue);
        }

        /* --- El Reloj --- */
        .reloj-contenedor {
            position: relative;
            width: 85vmin; 
            height: 85vmin;
            border-radius: 50%;
            background: radial-gradient(circle, #111 40%, #000 100%);
            border: 0.5vmin solid var(--color-borde);
            box-shadow: 
                0 0 5vmin rgba(0,0,0,0.9),
                inset 0 0 10vmin rgba(0,0,0,1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 1. CAPA EXTERIOR (D√çA / SEGUNDOS TOTALES) --- */
        
        /* Marca de Hora (Principal) */
        .marca-hora {
            position: absolute;
            width: 0.25vmin;
            height: 2.5vmin;
            background-color: #555;
            left: 50%;
            top: 0;
            transform-origin: 50% 42.5vmin; /* Radio = 85/2 */
        }

        /* Marca de Media Hora (30 min) */
        .marca-media {
            position: absolute;
            width: 0.15vmin;
            height: 1.5vmin;
            background-color: #333;
            left: 50%;
            top: 1vmin; /* Un poco m√°s abajo */
            transform-origin: 50% 41.5vmin; 
        }

        /* Marca de Cuarto (15 min y 45 min) */
        .marca-cuarto {
            position: absolute;
            width: 0.1vmin;
            height: 1vmin;
            background-color: #222;
            left: 50%;
            top: 1.5vmin;
            transform-origin: 50% 41vmin; 
        }

        /* Etiquetas Texto (XX.Xk) */
        .etiqueta-outer {
            position: absolute;
            width: 10vmin;
            height: 8vmin;
            left: 50%;
            top: 50%;
            margin-left: -5vmin;
            margin-top: -4vmin;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: none;
        }
        .txt-k {
            font-family: 'Courier New', monospace;
            font-size: 2vmin;
            color: var(--neon-blue);
            font-weight: bold;
            letter-spacing: -0.1vmin;
        }
        .txt-hora-ref {
            font-size: 1.2vmin;
            color: var(--text-dim);
            margin-top: 0.2vmin;
        }

        /* --- 2. CAPA INTERMEDIA (MINUTOS FANTASMA) --- */
        .marca-minuto {
            position: absolute;
            width: 0.15vmin;
            height: 1.2vmin;
            background-color: #1a1a1a; 
            left: 50%;
            top: 50%;
            margin-left: -0.075vmin;
            margin-top: -25vmin; /* Radio interno */
            transform-origin: 50% 25vmin; 
        }
        .marca-minuto.quinto {
            background-color: #333;
            height: 1.8vmin;
        }

        /* --- 3. MANECILLAS --- */

        /* Minutera (Opaca) */
        .manecilla-minuto {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 1.2vmin;
            height: 23vmin; 
            background-color: var(--manecilla-min);
            transform-origin: bottom center;
            border-radius: 1vmin;
            z-index: 9; 
            backdrop-filter: blur(2px);
        }

        /* D√≠a (Principal) */
        .manecilla-dia {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 0.5vmin;
            height: 38vmin; 
            background: var(--manecilla-dia);
            transform-origin: bottom center;
            border-radius: 1vmin;
            z-index: 10;
            box-shadow: 0 0 1.5vmin rgba(0, 243, 255, 0.3);
        }

        /* Segundera (Roja) */
        .manecilla-segundera {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 0.2vmin; 
            height: 40vmin; 
            background-color: var(--manecilla-seg);
            transform-origin: bottom center;
            z-index: 12;
            box-shadow: 0 0 1vmin rgba(255, 0, 85, 0.4);
        }
        .manecilla-segundera::after {
            content: '';
            position: absolute;
            top: 40vmin;
            left: -0.1vmin;
            width: 0.4vmin;
            height: 4vmin;
            background-color: var(--manecilla-seg);
        }

        /* Centro */
        .centro {
            position: absolute;
            width: 2vmin;
            height: 2vmin;
            background-color: #eee;
            border-radius: 50%;
            z-index: 15;
            box-shadow: 0 0 2vmin rgba(0,0,0,1);
        }

        /* --- Panel Digital Central (INTACTO) --- */
        .panel-central {
            z-index: 5;
            position: absolute;
            top: 60%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .digital-grande {
            font-family: 'Courier New', monospace;
            font-size: 5.5vmin;
            color: white;
            font-weight: bold;
            text-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }
        .digital-label {
            color: #555;
            font-size: 1.1vmin;
            text-transform: uppercase;
            letter-spacing: 0.3vmin;
        }

    </style>
</head>
<body>

    <h1 class="titulo-principal">HEARTBEAT CLOCK</h1>

    <div class="controles">
        <button id="btn-sound" class="btn" onclick="toggleSound()">üîá Sonido</button>
        <button id="btn-fullscreen" class="btn" onclick="toggleFullScreen()">‚õ∂ Fullscreen</button>
    </div>

    <div class="reloj-contenedor" id="reloj">
        
        <div id="capa-minutos"></div>

        <div id="capa-subdivisiones"></div>

        <div class="manecilla-minuto" id="manecilla-minuto"></div>
        <div class="manecilla-dia" id="manecilla-dia"></div>
        <div class="manecilla-segundera" id="manecilla-segundera"></div>
        <div class="centro"></div>

        <div class="panel-central">
            <span class="digital-grande" id="display-actual">0</span>
            <span class="digital-label">Segundos Totales</span>
        </div>

    </div>

    <script>
        const reloj = document.getElementById('reloj');
        const capaMinutos = document.getElementById('capa-minutos');
        const capaSubdiv = document.getElementById('capa-subdivisiones');
        
        // Configuraci√≥n
        const radioTexto = 35; // vmin
        const segundosEnDia = 86400;

        // Variables de Audio
        let audioCtx = null;
        let soundEnabled = false;
        let lastSecond = -1; // Para detectar el cambio de segundo exacto

        // Funci√≥n para formatear "99.9k"
        function formatK(num) {
            if (num === 0) return "0k";
            const kVal = num / 1000;
            // toFixed(1) da un decimal. 
            return kVal.toFixed(1) + 'k';
        }

        // --- 1. Generar Esfera ---
        function crearEsfera() {
            
            // A. Anillo EXTERIOR (Horas + Sub-divisiones)
            for (let i = 0; i < 24; i++) {
                const rotacionHora = i * 15; // 15 grados por hora

                // 1. Marca de HORA (Grande)
                const marca = document.createElement('div');
                marca.classList.add('marca-hora');
                marca.style.transform = `rotate(${rotacionHora}deg)`;
                reloj.appendChild(marca);

                // 2. Marcas de SUB-DIVISIONES (15, 30, 45 min)
                // 15 min = 3.75 grados
                const sub15 = rotacionHora + 3.75;
                const sub30 = rotacionHora + 7.5;
                const sub45 = rotacionHora + 11.25;

                const m15 = document.createElement('div');
                m15.className = 'marca-cuarto';
                m15.style.transform = `rotate(${sub15}deg)`;
                capaSubdiv.appendChild(m15);

                const m30 = document.createElement('div');
                m30.className = 'marca-media'; // Mediana
                m30.style.transform = `rotate(${sub30}deg)`;
                capaSubdiv.appendChild(m30);

                const m45 = document.createElement('div');
                m45.className = 'marca-cuarto';
                m45.style.transform = `rotate(${sub45}deg)`;
                capaSubdiv.appendChild(m45);

                // 3. ETIQUETAS (Pares)
                if (i % 2 === 0) {
                    const etiqueta = document.createElement('div');
                    etiqueta.classList.add('etiqueta-outer');
                    
                    const anguloRad = (rotacionHora - 90) * (Math.PI / 180);
                    const x = radioTexto * Math.cos(anguloRad);
                    const y = radioTexto * Math.sin(anguloRad);

                    const valorRaw = i * 3600;
                    const valorFormat = formatK(valorRaw);

                    etiqueta.innerHTML = `
                        <span class="txt-k">${valorFormat}</span>
                        <span class="txt-hora-ref">${i}h</span>
                    `;
                    etiqueta.style.transform = `translate(${x}vmin, ${y}vmin)`;
                    reloj.appendChild(etiqueta);
                }
            }

            // B. Anillo INTERNO (Minutos Fantasma)
            for (let j = 0; j < 60; j++) {
                const marcaMin = document.createElement('div');
                marcaMin.classList.add('marca-minuto');
                if (j % 5 === 0) marcaMin.classList.add('quinto');
                marcaMin.style.transform = `rotate(${j * 6}deg)`;
                capaMinutos.appendChild(marcaMin);
            }
        }

        // --- 2. L√≥gica de Sonido (Tic-Tac) ---
        function playTick() {
            if (!soundEnabled) return;
            
            // Inicializar AudioContext si no existe (requiere gesto de usuario)
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            // Crear oscilador para el "Tic"
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // Sonido tipo "madera" o reloj mec√°nico (frecuencia alta, decay r√°pido)
            osc.type = 'sine'; 
            // Variar ligeramente el tono entre Tic y Tac (pares e impares)
            const isTac = (lastSecond % 2 === 0);
            osc.frequency.value = isTac ? 800 : 1000; // Hz
            
            // Volumen envolvente muy corto
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('btn-sound');
            if (soundEnabled) {
                btn.innerText = "üîä Sonido";
                btn.classList.add('activo');
                // Inicializar contexto al primer click
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            } else {
                btn.innerText = "üîá Sonido";
                btn.classList.remove('activo');
            }
        }

        // --- 3. Actualizar Reloj ---
        function actualizar() {
            const ahora = new Date();
            const h = ahora.getHours();
            const m = ahora.getMinutes();
            const s = ahora.getSeconds();
            const ms = ahora.getMilliseconds();

            // Detectar cambio de segundo para el sonido
            if (s !== lastSecond) {
                lastSecond = s;
                playTick();
            }

            const totalSegundos = (h * 3600) + (m * 60) + s;

            // Rotaciones
            const gradosDia = (totalSegundos / segundosEnDia) * 360;
            const gradosMin = (m * 6) + (s * 0.1);
            const gradosSeg = (s * 6) + (ms * 0.006); // Movimiento suave

            // Aplicar
            document.getElementById('manecilla-dia').style.transform = `rotate(${gradosDia}deg)`;
            document.getElementById('manecilla-minuto').style.transform = `rotate(${gradosMin}deg)`;
            document.getElementById('manecilla-segundera').style.transform = `rotate(${gradosSeg}deg)`;

            // Digital Central (Sin tocar formato)
            document.getElementById('display-actual').innerText = totalSegundos.toLocaleString();
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        // Inicio
        crearEsfera();
        function loop() {
            actualizar();
            requestAnimationFrame(loop);
        }
        loop();

    </script>
</body>
</html>
